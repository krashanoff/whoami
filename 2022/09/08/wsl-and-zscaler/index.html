
<!DOCTYPE html>
<html lang="en-us">
  <head>
    <title>krashanoff | WSL and ZScaler</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="The website of Leo Krashanoff">
    <link
      rel="icon"
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAIAAACQd1PeAAAACXBIWXMAAC4jAAAuIwF4pT92AAAADElEQVQImWOoX/UGAAPBAhajZVPkAAAAAElFTkSuQmCC"
      type="image/png"
    />
    <link rel="stylesheet" type="text/css" href="/index.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.5.1/katex.min.css">
  </head>
  <body>
    
<a href="/">krashanoff</a>
<article>
  <h1 id="title">WSL and ZScaler</h1>
  <small><date>Sep 8, 2022</date> | <span class="wordcount">228 words</span></small>
  <ul class="tags">
    
    
    
    
    <li><a href="/tag/software">#software</a></li>
    
    
  </ul>
  <p>WSL2 uses a real Linux kernel, but its networking is proxied through the host system. For corporate laptops using ZScaler, there is a root CA certificate installed to the machine to allow sniffing of TLS/SSL traffic as it travels through the intranet. This poses a problem for virtualized hosts. If you try to <code>curl</code> an HTTPS address on your WSL virtual machine, for example, the program will complain of an invalid certificate. We subvert this by copying the root certificate to our virtual machine.</p>
<p>Assuming that your host machine has WSL2 installed and configured, the setup process is as follows:</p>
<ol>
<li>Open the Windows certificate manager and navigate to your &quot;Trusted Root Certification Authorities&quot;.</li>
<li>In the &quot;Certificates&quot; section, you can locate your ZScaler Root CA.</li>
<li>Right-clicking this certificate can export your certificate as a DER (or similar).</li>
<li>Convert this certificate using <code>openssl</code>: <code>openssl x509 -inform DER -in /path/to/your/cert -out /usr/local/share/ca-certificates/zscaler.crt</code></li>
<li>Finally, update the VM's CA certificate database: <code>update-ca-certificates</code></li>
</ol>
<p>You should get some output about how your new list of credentials has <em>one more</em> than the old version. If you added some other certificates between updates, this number may be higher.</p>
<hr>
<p>Sidebar: some web browsers are pretty firm about their certificate stores. <a href="https://www.waterfox.net/">Waterfox</a> is one of them. Trying to browse to a known website using Waterfox on a ZScaler-enabled laptop will give you a TLS error.</p>

</article>


    <footer>
      Copyright &copy; 2023 Leonid Krashanoff
    </footer>

  </body>
</html>
